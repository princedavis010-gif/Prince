<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Tap Master v57.7</title>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --gold: #f3ba2f; --green: #00ff88; --dia: #00d2ff; --purple: #a020f0; --bg: #010205; }
        * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; touch-action: manipulation; }
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'Segoe UI', sans-serif; color: white; background: var(--bg); transition: 0.8s; }
        .nebula-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; background: #010205; }
        
        /* THE CUSTOM 3D COIN DESIGN */
        .coin-wrapper { perspective: 1000px; margin: 30px 0; z-index: 5; }
        .coin-btn { 
            width: 310px; height: 310px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            transition: transform 0.1s ease-out; 
            transform-style: preserve-3d; cursor: pointer;
            /* Built-in Digital Asset: Gold plating with Diamond-P glow */
            background: radial-gradient(circle at 30% 30%, #ffe08a 0%, #f3ba2f 50%, #8e6d1a 100%);
            border: 12px solid #3d2f07;
            position: relative;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9), inset 0 0 40px rgba(255,255,255,0.4);
        }
        
        /* The Diamond "P" Logo Asset */
        .coin-btn::before {
            content: 'P';
            font-size: 160px;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 20px #00d2ff, 0 0 40px #fff;
            filter: drop-shadow(2px 4px 6px black);
            z-index: 2;
        }

        /* 3D Side/Edge Asset */
        .coin-btn::after {
            content: ''; position: absolute; width: 100%; height: 100%;
            border-radius: 50%; transform: translateZ(-20px); 
            background: #8e6d1a; border: 4px solid #3d2f07;
            box-shadow: inset 0 0 20px black;
        }

        .container { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; width: 100%; }
        .container.active { display: flex; animation: fadeIn 0.4s ease; }
        .nav { height: 85px; background: #000; display: flex; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #222; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; padding-top: 20px; color: #666; font-size: 10px; font-weight: bold; }
        .nav-item.active { color: var(--gold); }
        #ad-countdown { display: none; position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); border: 1px solid var(--gold); padding: 15px 30px; border-radius: 50px; z-index: 10001; font-weight: bold; color: var(--gold); }
    </style>
</head>
<body onload="initApp();">
    <div id="ad-countdown">NEXT AD IN: <span id="ad-timer-val">7</span>s</div>
    
    <div id="home" class="container active">
        <div id="balance" onclick="adminTrigger()" style="font-size: 55px; font-weight: 900; color: var(--gold); cursor:pointer;">0</div>
        <div style="font-size: 20px; color: var(--dia); font-weight: bold;">ðŸ’Ž <span id="diamonds">0</span></div>
        <div id="prem-timer" style="color:var(--green); font-weight:bold; font-size:12px; height:15px;"></div>
        
        <div class="coin-wrapper">
            <div class="coin-btn" id="coin"></div>
        </div>
        
        <div id="boost-timer" style="color:var(--purple); font-weight:bold; height:20px;"></div>
        <div style="color:#777; font-size:12px;">âš¡ <span id="energy">1000</span> / 1000</div>
        <button class="btn-gold" style="background: var(--dia); color:#000;" onclick="showDoubleAd()">ðŸ“º WATCH ADS (+3,000)</button>
    </div>

    <script>
        /* ALL v57.6 JAVASCRIPT LOGIC IS PRESERVED BELOW */
        const tg = window.Telegram.WebApp;
        const uid = tg.initDataUnsafe.user ? String(tg.initDataUnsafe.user.id) : "0000";
        const v = "v3_"; 

        // Economy & Persistence
        let bal = parseInt(localStorage.getItem(v+'bal_'+uid)) || 0;
        let dia = parseInt(localStorage.getItem(v+'dia_'+uid)) || 0;
        let salt = parseInt(localStorage.getItem(v+'salt_'+uid)) || 1;
        let hasBot = localStorage.getItem(v+'bot_'+uid) === 'true';
        let premExpiry = parseInt(localStorage.getItem(v+'premExp_'+uid)) || 0;
        let lastVisit = parseInt(localStorage.getItem(v+'lastVis_'+uid)) || Date.now();
        let adThreshold = 0;

        function handleTap(e) {
            e.preventDefault();
            const touches = e.changedTouches;
            for (let i = 0; i < touches.length; i++) {
                let val = (premExpiry > Date.now() ? 20 : 1);
                bal += val; adThreshold += val;
                
                // Tilt Physics (TapSwap Style)
                const rect = document.getElementById('coin').getBoundingClientRect();
                const rotateY = ((touches[i].clientX - (rect.left + rect.width/2)) / (rect.width/2)) * 40;
                const rotateX = -((touches[i].clientY - (rect.top + rect.height/2)) / (rect.height/2)) * 40;
                document.getElementById('coin').style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;
                setTimeout(() => document.getElementById('coin').style.transform = "rotateY(0deg) rotateX(0deg)", 100);
                
                if(adThreshold >= 3000) { adThreshold = 0; triggerThresholdAd(); }
            }
            updateUI();
        }

        function showDoubleAd() {
            AdController.show().then(() => {
                let wait = 7;
                document.getElementById('ad-countdown').style.display = 'block';
                const t = setInterval(() => {
                    wait--; document.getElementById('ad-timer-val').innerText = wait;
                    if(wait <= 0) {
                        clearInterval(t); document.getElementById('ad-countdown').style.display = 'none';
                        AdController.show().then(() => {
                            bal += 3000; updateUI();
                            tg.showAlert("You have been rewarded 3000 coins, congratulations ðŸ¤‘ðŸŽ‰. Thank you.");
                        });
                    }
                }, 1000);
            });
        }
        
        // Final UI Update Logic
        function updateUI() {
            if (bal >= 50000) { bal -= 50000; dia++; confetti(); }
            document.getElementById('balance').innerText = bal.toLocaleString();
            document.getElementById('diamonds').innerText = dia;
            localStorage.setItem(v+'bal_'+uid, bal);
            localStorage.setItem(v+'dia_'+uid, dia);
        }
        document.getElementById('coin').addEventListener('touchstart', handleTap);
    </script>
</body>
</html>
