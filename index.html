<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Tap: Ultimate Viral</title>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --gold: #f3ba2f; --green: #00ff88; --dia: #00d2ff; --purple: #a020f0; --bg: #010205; }
        * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; touch-action: manipulation; }
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'Segoe UI', sans-serif; color: white; background: var(--bg); transition: 0.8s; }

        /* SUPERNOVA WARP BACKGROUND */
        .nebula-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; background: #010205; overflow: hidden; }
        .nebula-glow { position: absolute; width: 200%; height: 200%; top: -50%; left: -50%; background: radial-gradient(circle, rgba(160,32,240,0.4) 0%, rgba(0,210,255,0.1) 40%, transparent 70%); opacity: 0; transition: 1.5s; z-index: -1; pointer-events: none; }
        body.boost-active .nebula-glow { opacity: 1; animation: supernovaWarp 3s infinite linear; }
        @keyframes supernovaWarp { 0% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.3) rotate(180deg); } 100% { transform: scale(1) rotate(360deg); } }

        .container { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; width: 100%; }
        .container.active { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* SKIN STYLES */
        .coin-btn { width: 260px; height: 260px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 130px; font-weight: 900; transition: 0.1s; transform-style: preserve-3d; cursor: pointer; }
        .skin-gold { background: radial-gradient(circle, #ffe08a, #f3ba2f, #8e6d1a); border: 10px solid #3d2f07; color: #3d2f07; box-shadow: 0 15px 40px rgba(243,186,47,0.3); }
        .skin-silver { background: radial-gradient(circle, #e0e0e0, #9e9e9e, #424242); border: 10px solid #212121; color: #212121; }
        .skin-diamond { background: radial-gradient(circle, #e3f2fd, #00d2ff, #01579b); border: 10px solid #001f3f; color: #001f3f; box-shadow: 0 0 30px var(--dia); }

        .btn-gold { background: linear-gradient(135deg, var(--gold), #bf9524); color: #221a04; padding: 16px; border-radius: 15px; font-weight: 800; border: none; width: 100%; margin-top: 10px; cursor: pointer; text-transform: uppercase; }
        .glass-card { background: rgba(255,255,255,0.06); border-radius: 18px; padding: 15px; width: 100%; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.1); }
        
        .nav { height: 85px; background: #000; display: flex; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #222; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; padding-top: 20px; color: #666; font-size: 10px; font-weight: bold; }
        .nav-item.active { color: var(--gold); }
        
        .mission-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .streak-day { width: 40px; height: 50px; background: #222; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; }
        .streak-day.active { background: var(--gold); color: #000; font-weight: bold; }
    </style>
</head>
<body onload="initApp();">
    <div class="nebula-bg"><div class="nebula-glow"></div></div>

    <div id="home" class="container active">
        <div id="balance" onclick="adminTrigger()" style="font-size: 55px; font-weight: 900; color: var(--gold);">0</div>
        <div style="font-size: 20px; color: var(--dia); font-weight: bold;">üíé <span id="diamonds">0</span></div>
        
        <div class="glass-card" style="display:flex; justify-content: space-around; padding: 10px;">
            <div id="streak-container" style="display:flex; gap:5px;"></div>
        </div>

        <div class="coin-wrapper" style="perspective:1000px; margin: 10px 0;">
            <div class="coin-btn skin-gold" id="coin">P</div>
        </div>
        
        <div id="boost-timer" style="color:var(--purple); font-weight:bold; height:20px;"></div>
        <div style="color:#777; font-size:12px;">‚ö° <span id="energy">1000</span> / 1000</div>
        <button class="btn-gold" style="background: var(--dia); color:#000;" onclick="showAd()">üì∫ WATCH AD (+2,000)</button>
    </div>

    <div id="missions" class="container">
        <h2 style="color:var(--gold);">TASKS & MISSIONS</h2>
        <div class="glass-card">
            <div class="mission-item">
                <span>Join Channel</span>
                <button class="btn-gold" style="width:80px; margin:0; padding:8px;" onclick="doMission('chan', 5000)">+5k</button>
            </div>
            <div class="mission-item">
                <span>Follow on X</span>
                <button class="btn-gold" style="width:80px; margin:0; padding:8px;" onclick="doMission('x', 5000)">+5k</button>
            </div>
            <div class="mission-item">
                <span>Watch YouTube</span>
                <button class="btn-gold" style="width:80px; margin:0; padding:8px;" onclick="doMission('yt', 10000)">+10k</button>
            </div>
        </div>
    </div>

    <div id="shop" class="container">
        <h2 style="color:var(--gold);">UPGRADES</h2>
        <div class="glass-card">
            <h3>ü§ñ AUTO-TAP BOT</h3>
            <p>Farms while you sleep!</p>
            <button class="btn-gold" id="bot-btn" onclick="buyBot()">BUY FOR 2 üíé</button>
        </div>
        <div class="glass-card">
            <h3>üé® COIN SKINS</h3>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-gold" style="background:#9e9e9e;" onclick="setSkin('silver')">SILVER</button>
                <button class="btn-gold" style="background:var(--dia);" onclick="setSkin('diamond')">DIAMOND</button>
            </div>
        </div>
    </div>

    <div id="leaderboard" class="container">
        <h2 style="color:var(--gold);">LEADERBOARD</h2>
        <div class="glass-card" id="lb-list">
            <p>1. Prince Davis (Admin) - ‚àû</p>
            <p>2. Top User #128 - 450,000</p>
            <p>3. CryptoKing - 310,000</p>
            <hr style="border:0; border-top:1px solid #333;">
            <p style="color:var(--gold);">Your Rank: #4,502</p>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="showTab('home', this)">ü™ô<br>Home</div>
        <div class="nav-item" onclick="showTab('missions', this)">üìã<br>Tasks</div>
        <div class="nav-item" onclick="showTab('shop', this)">‚ö°<br>Store</div>
        <div class="nav-item" onclick="showTab('leaderboard', this)">üèÜ<br>Ranks</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const uid = tg.initDataUnsafe.user ? String(tg.initDataUnsafe.user.id) : "GUEST";
        
        let bal = parseInt(localStorage.getItem('bal_'+uid)) || 0;
        let dia = parseInt(localStorage.getItem('dia_'+uid)) || 0;
        let streak = parseInt(localStorage.getItem('streak_'+uid)) || 0;
        let hasBot = localStorage.getItem('bot_'+uid) === 'true';
        let currentSkin = localStorage.getItem('skin_'+uid) || 'gold';
        let lastVisit = localStorage.getItem('lastV_'+uid);
        let eng = 1000, isBoosted = false;

        function initApp() {
            checkStreak();
            updateUI();
            setSkin(currentSkin);
            if(hasBot) startAutoBot();
        }

        function updateUI() {
            if (bal >= 20000) { bal -= 20000; dia++; confetti(); }
            document.getElementById('balance').innerText = bal.toLocaleString();
            document.getElementById('diamonds').innerText = dia;
            document.getElementById('energy').innerText = eng;
            document.getElementById('bot-btn').innerText = hasBot ? "BOT ACTIVE ‚úÖ" : "BUY FOR 2 üíé";
            
            // Render Streak UI
            let sHTML = "";
            for(let i=1; i<=7; i++) {
                let active = i <= streak ? "active" : "";
                sHTML += `<div class="streak-day ${active}">D${i}<br>üéÅ</div>`;
            }
            document.getElementById('streak-container').innerHTML = sHTML;

            localStorage.setItem('bal_'+uid, bal);
            localStorage.setItem('dia_'+userId, dia);
            localStorage.setItem('bot_'+uid, hasBot);
            localStorage.setItem('streak_'+uid, streak);
        }

        function checkStreak() {
            const now = new Date();
            const last = lastVisit ? new Date(lastVisit) : null;
            if(!last) { streak = 1; }
            else {
                const diff = (now - last) / (1000 * 60 * 60);
                if(diff > 24 && diff < 48) { streak = (streak % 7) + 1; }
                else if(diff >= 48) { streak = 1; }
            }
            localStorage.setItem('lastV_'+uid, now.toISOString());
        }

        function setSkin(s) {
            const c = document.getElementById('coin');
            c.className = 'coin-btn skin-' + s;
            currentSkin = s;
            localStorage.setItem('skin_'+uid, s);
        }

        function buyBot() {
            if(!hasBot && dia >= 2) { dia -= 2; hasBot = true; startAutoBot(); updateUI(); tg.showAlert("Bot Purchased! Farming started."); }
        }

        function startAutoBot() {
            setInterval(() => { bal += 1; updateUI(); }, 5000); // 1 coin every 5 sec
        }

        function doMission(m, reward) {
            if(!localStorage.getItem('m_'+m+uid)) {
                bal += reward;
                localStorage.setItem('m_'+m+uid, 'true');
                updateUI();
                tg.showAlert(`Mission Complete! +${reward} coins.`);
            } else { tg.showAlert("Mission already done!"); }
        }

        // COIN TAP LOGIC
        document.getElementById('coin').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(eng > 0) {
                bal += isBoosted ? 5 : 1;
                eng--; updateUI();
                const rect = e.target.getBoundingClientRect();
                const x = ((e.touches[0].clientX - rect.left) / rect.width - 0.5) * 40;
                const y = ((e.touches[0].clientY - rect.top) / rect.height - 0.5) * -40;
                e.target.style.transform = `rotateY(${x}deg) rotateX(${y}deg) scale(0.95)`;
                setTimeout(() => e.target.style.transform = "rotate(0) scale(1)", 100);
            }
        });

        function showTab(id, el) { 
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active'); el.classList.add('active');
        }

        function showAd() {
            window.Adsgram.init({ blockId: "22672" }).show().then(() => { bal += 2000; updateUI(); });
        }

        setInterval(() => { if(eng < 1000) { eng++; updateUI(); } }, 1500);
    </script>
</body>
</html>
