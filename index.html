<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Tap: Elite</title>
    <script src="https://adsgram.ai/sdk/v1/adman.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f3ba2f; --green: #00ff88; --dia: #00d2ff; --red: #ff4444; }
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; color: white; background: #0b0e11; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: none; position: relative; }

        /* LIVE BACKGROUND */
        .bg-animate { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; background: radial-gradient(circle at 50% 50%, #1c1f24 0%, #0b0e11 100%); }
        .blob { position: absolute; width: 350px; height: 350px; background: linear-gradient(135deg, rgba(243, 186, 47, 0.15), rgba(0, 210, 255, 0.1)); filter: blur(90px); border-radius: 50%; animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(-20%, -20%); } to { transform: translate(20%, 20%); } }

        #reward-feed { position: absolute; top: -60px; left: 50%; transform: translateX(-50%); width: 85%; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); padding: 10px; border-radius: 12px; font-size: 11px; font-weight: bold; color: var(--dia); transition: top 0.5s; z-index: 4000; text-align: center; }
        #reward-feed.show { top: 15px; }

        .container { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; }
        .container.active { display: flex; }
        
        .btn-gold { background: linear-gradient(to bottom, #f3ba2f, #bf9524); color: #403108; padding: 15px; border-radius: 14px; font-weight: 800; border: none; width: 95%; text-transform: uppercase; cursor: pointer; margin-top: 10px; box-shadow: 0 5px 0 #8e6d1a; transition: transform 0.05s, box-shadow 0.05s; }
        .btn-gold:active { transform: translateY(4px); box-shadow: 0 1px 0 #8e6d1a; }
        
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); width: 90%; padding: 15px; border-radius: 18px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 12px; }
        
        .coin-wrap { position: relative; margin: 20px 0; display: flex; justify-content: center; align-items: center; width: 100%; perspective: 1000px; }
        .coin-btn { width: 280px; height: 280px; background: radial-gradient(circle at 30% 30%, #ffe08a 0%, #f3ba2f 40%, #bf9524 100%); border-radius: 50%; border: 4px solid #5c4711; outline: 8px solid var(--gold); outline-offset: -12px; box-shadow: 0 20px 40px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; font-size: 130px; color: #5c4711; font-weight: 900; transition: transform 0.1s; }
        
        .turbo-ring { position: absolute; width: 310px; height: 310px; border: 4px dashed var(--red); border-radius: 50%; display: none; animation: rotate 2s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .coin-btn.turbo { outline: 8px solid var(--red); animation: turboScale 0.3s infinite alternate; }
        @keyframes turboScale { from { transform: scale(1); } to { transform: scale(1.05); } }

        .tap-anim { position: absolute; color: white; font-size: 38px; font-weight: 900; pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 1000; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-150px) scale(1.5); } }

        .nav { height: 75px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; position: fixed; bottom: 0; width: 100%; border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 3000;}
        .nav-item { color: #888; font-size: 11px; text-align: center; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--gold); }
    </style>
</head>
<body>
    <div class="bg-animate"><div class="blob"></div></div>
    <div id="reward-feed"></div>

    <div id="home" class="container active">
        <div id="user-display" style="color:var(--green); font-size:14px; font-weight:bold;"></div>
        <div id="balance" style="font-size: 50px; font-weight: 900; color: var(--gold);">0</div>
        <div style="color: var(--dia); font-weight: bold;">üíé <span id="diamonds">0</span> Diamonds</div>
        <div style="color: #ccc; margin: 5px 0;">‚ö° <span id="energy">1000</span> / <span id="max-energy">1000</span></div>
        <div id="turbo-timer" style="color: var(--red); font-weight: bold; display:none; background:rgba(0,0,0,0.5); padding:5px 15px; border-radius:20px;">üî• TURBO: <span id="sec">25</span>s</div>
        
        <div class="coin-wrap">
            <div class="turbo-ring" id="ring"></div>
            <div class="coin-btn" id="coin">P</div>
        </div>
        
        <button class="btn-gold" style="background: var(--dia); color: #004a5c;" onclick="runAd()">üì∫ Watch Ad (+1,000)</button>
    </div>

    <div id="boost" class="container">
        <h2 style="color: var(--gold);">Boosters</h2>
        <div class="glass-card">
            <h4 style="margin:0; color:var(--green);">Daily Free Rewards</h4>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-gold" style="font-size:10px; margin:0;" onclick="useDaily('turbo')">üöÄ Turbo (<span id="d-turbo">4</span>)</button>
                <button class="btn-gold" style="font-size:10px; margin:0; background:var(--dia);" onclick="useDaily('refill')">‚ö° Refill (<span id="d-refill">3</span>)</button>
            </div>
        </div>
        <div class="glass-card">
            <h4 style="color: var(--dia); margin:0;">Perfect Referral</h4>
            <button class="btn-gold" onclick="shareRef()">Invite Friend</button>
            <button id="claim-ref-btn" class="btn-gold" style="background:var(--green); display:none;" onclick="claimReferral()">üéÅ Claim Welcome Bonus</button>
        </div>
        <div class="glass-card" style="display:flex; justify-content: space-between; align-items: center;">
            <div><h4 style="margin:0; color:var(--gold);">Recharge Speed</h4><p style="margin:0; font-size:10px;">Lvl <span id="lvl-speed">1</span></p></div>
            <button class="btn-gold" style="width:auto; padding: 8px 15px; margin:0;" onclick="buyBoost('speed')">üí∞ <span id="cost-speed">250</span></button>
        </div>
        <div class="glass-card" style="display:flex; justify-content: space-between; align-items: center;">
            <div><h4 style="margin:0; color:var(--gold);">Energy Tank</h4><p style="margin:0; font-size:10px;">Lvl <span id="lvl-tank">1</span></p></div>
            <button class="btn-gold" style="width:auto; padding: 8px 15px; margin:0;" onclick="buyBoost('tank')">üí∞ <span id="cost-tank">250</span></button>
        </div>
    </div>

    <div id="pay" class="container">
        <h2 style="color: var(--gold);">Elite Status</h2>
        <div id="sub-active-view">
            <div class="glass-card" style="text-align:center;">
                <p>Premium: 10x Tap Multiplier</p>
                <p style="color: var(--gold); font-size: 20px; font-weight: bold;">OPay: 8124647818</p>
                <button class="btn-gold" onclick="sendWA()">Message Admin</button>
            </div>
            <div style="text-align:center; width:100%; margin-top:20px;">
                <input type="text" id="secret-code" class="btn-gold" style="background:rgba(0,0,0,0.5); color:#fff; border: 1px solid #333;" placeholder="Code">
                <input type="text" id="username-input" class="btn-gold" style="background:rgba(0,0,0,0.5); color:#fff; border: 1px solid #333;" placeholder="Username">
                <button class="btn-gold" style="background: var(--green);" onclick="strictSubscribe()">Activate</button>
            </div>
        </div>
        <div id="sub-locked-view" style="display:none; color:var(--green); text-align:center;"><h3>‚úÖ ELITE MEMBER ACTIVATED</h3></div>
    </div>

    <div id="settings" class="container">
        <h2 style="color: var(--gold);">Settings</h2>
        <div class="glass-card" style="text-align:center;">
            <p id="p-username" style="font-size: 22px; color: var(--green); font-weight: bold;">GUEST</p>
            <p style="color:#888;">UID Suffix: <span id="p-suffix"></span></p>
        </div>
        <div class="glass-card" style="text-align:center;">
            <h4 style="color: var(--dia); margin:0;">Redeem Airtime (‚Ç¶100)</h4>
            <button class="btn-gold" style="background: var(--dia); color:#000;" onclick="requestRedeem()">Request Airtime</button>
            <div style="margin-top:15px; display:flex; gap:5px;">
                <input type="text" id="admin-clear-input" class="btn-gold" style="background:rgba(0,0,0,0.5); color:#fff; border:1px solid #333; flex:2; margin:0;" placeholder="Clearance Code">
                <button class="btn-gold" style="background:var(--green); flex:1; margin:0;" onclick="clearDiamond()">Clear</button>
            </div>
        </div>
        <button class="btn-gold" style="background:var(--red); color:#fff; margin-top:30px;" onclick="factoryReset()">‚ö†Ô∏è Reset App</button>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="showTab('home', this)">ü™ô<br>Tap</div>
        <div class="nav-item" onclick="showTab('boost', this)">üöÄ<br>Boost</div>
        <div class="nav-item" onclick="showTab('pay', this)">‚≠ê<br>Elite</div>
        <div class="nav-item" onclick="showTab('settings', this)">‚öôÔ∏è<br>Settings</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "00";
        const suffix = parseInt(String(userId).slice(-2));
        const REQUIRED_CODE = "Prince2026" + (suffix * 3 + 7);
        const BOT_USERNAME = "PrinceTap_bot";

        let bal = parseInt(localStorage.getItem('bal_'+userId)) || 0;
        let lifetime = parseInt(localStorage.getItem('life_'+userId)) || 0;
        let diamonds = parseInt(localStorage.getItem('dia_'+userId)) || 0;
        let isPremium = localStorage.getItem('premium_'+userId) === 'true';
        let userNick = localStorage.getItem('nick_'+userId) || "GUEST";
        let lvlSpeed = parseInt(localStorage.getItem('lvlSpeed_'+userId)) || 1;
        let lvlTank = parseInt(localStorage.getItem('lvlTank_'+userId)) || 1;
        let eng = parseInt(localStorage.getItem('eng_'+userId)) || 1000;
        let tapCounter = parseInt(localStorage.getItem('tapCount_'+userId)) || 0;
        let dTurbo = parseInt(localStorage.getItem('dTurbo_'+userId)) ?? 4;
        let dRefill = parseInt(localStorage.getItem('dRefill_'+userId)) ?? 3;
        let isTurbo = false;

        function updateUI() {
            checkDailyReset();
            if (bal >= 20000) { bal = 1; diamonds += 1; tg.showAlert("üíé DIAMOND EARNED! Balance reset."); }

            const maxEng = 500 + (lvlTank * 500);
            document.getElementById('balance').innerText = bal.toLocaleString();
            document.getElementById('diamonds').innerText = diamonds;
            document.getElementById('energy').innerText = eng;
            document.getElementById('max-energy').innerText = maxEng;
            document.getElementById('lvl-speed').innerText = lvlSpeed;
            document.getElementById('cost-speed').innerText = (lvlSpeed + 1) * 250;
            document.getElementById('lvl-tank').innerText = lvlTank;
            document.getElementById('cost-tank').innerText = (lvlTank + 1) * 250;
            document.getElementById('d-turbo').innerText = dTurbo;
            document.getElementById('d-refill').innerText = dRefill;
            document.getElementById('p-username').innerText = userNick.toUpperCase();
            document.getElementById('p-suffix').innerText = suffix;
            document.getElementById('user-display').innerText = isPremium ? "üëë " + userNick.toUpperCase() : "";
            
            if (isPremium) {
                document.getElementById('sub-active-view').style.display = "none";
                document.getElementById('sub-locked-view').style.display = "block";
            }

            localStorage.setItem('bal_'+userId, bal);
            localStorage.setItem('life_'+userId, lifetime);
            localStorage.setItem('dia_'+userId, diamonds);
            localStorage.setItem('eng_'+userId, eng);
            localStorage.setItem('lvlSpeed_'+userId, lvlSpeed);
            localStorage.setItem('lvlTank_'+userId, lvlTank);
            localStorage.setItem('tapCount_'+userId, tapCounter);
            localStorage.setItem('dTurbo_'+userId, dTurbo);
            localStorage.setItem('dRefill_'+userId, dRefill);
        }

        // --- 3 AM RESET LOGIC ---
        function checkDailyReset() {
            const now = new Date();
            const todayTag = now.toISOString().split('T')[0];
            const lastResetDate = localStorage.getItem('lastResetDate_' + userId);
            if (now.getHours() >= 3 && lastResetDate !== todayTag) {
                dTurbo = 4; dRefill = 3;
                localStorage.setItem('lastResetDate_' + userId, todayTag);
                updateUI();
            }
        }

        function useDaily(type) {
            if (type === 'turbo' && dTurbo > 0 && !isTurbo) {
                dTurbo--; isTurbo = true;
                document.getElementById('turbo-timer').style.display = 'block';
                document.getElementById('coin').classList.add('turbo');
                document.getElementById('ring').style.display = 'block';
                let s = 25;
                let t = setInterval(() => {
                    s--; document.getElementById('sec').innerText = s;
                    if(s <= 0) { clearInterval(t); isTurbo = false; document.getElementById('turbo-timer').style.display = 'none'; document.getElementById('coin').classList.remove('turbo'); document.getElementById('ring').style.display = 'none'; }
                }, 1000);
            } else if (type === 'refill' && dRefill > 0) {
                dRefill--; eng = 500 + (lvlTank * 500); tg.showAlert("Energy Refilled!");
            }
            updateUI();
        }

        // --- REFERRAL & REDEMPTION ---
        const urlParams = new URLSearchParams(window.location.search);
        const referrerId = tg.initDataUnsafe.start_param || urlParams.get('startapp');
        if (referrerId && !localStorage.getItem('refClaimed_'+userId)) document.getElementById('claim-ref-btn').style.display = 'block';

        function claimReferral() {
            bal += 2000; localStorage.setItem('refClaimed_'+userId, 'true');
            document.getElementById('claim-ref-btn').style.display = 'none'; tg.showAlert("üéÅ Welcome Bonus +2k!"); updateUI();
        }
        function shareRef() { tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent('https://t.me/'+BOT_USERNAME+'/play?startapp='+userId)}&text=Join Prince Tap!`); }
        function copyRef() { const el = document.createElement('textarea'); el.value = `https://t.me/${BOT_USERNAME}/play?startapp=${userId}`; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); tg.showAlert("Link Copied!"); }

        function requestRedeem() {
            if (diamonds >= 1) {
                const txId = "PT-" + Math.floor(Math.random() * 900 + 100) + (suffix + 10);
                window.open(`https://wa.me/2348124647818?text=REDEEM REQUEST%0AUser: ${userNick}%0ATXID: ${txId}`);
                tg.showAlert("Request Sent! Diamonds stay until Admin clears them.");
            } else { tg.showAlert("Need 1 Diamond!"); }
        }
        function clearDiamond() {
            if (document.getElementById('admin-clear-input').value.trim() === "Clear" + (suffix * 2)) {
                if (diamonds >= 1) { diamonds -= 1; updateUI(); tg.showAlert("‚úÖ Diamond Cleared!");
                setTimeout(() => window.open(`https://wa.me/2348124647818?text=I have successfully cleared my Diamond!`), 2000); }
            } else { tg.showAlert("Invalid Code!"); }
        }

        // --- TAPPING ---
        const coin = document.getElementById('coin');
        coin.addEventListener('pointerdown', (e) => {
            if (eng > 0 || isTurbo) {
                const val = (isPremium ? 10 : 1) * (isTurbo ? 5 : 1); 
                bal += val; if(!isTurbo) eng--; tapCounter++; 
                const float = document.createElement('div');
                float.className = 'tap-anim'; float.innerText = '+' + val;
                float.style.left = (e.clientX - 20) + 'px'; float.style.top = (e.clientY - 40) + 'px';
                document.body.appendChild(float); setTimeout(() => float.remove(), 800);
                const rect = coin.getBoundingClientRect();
                coin.style.transform = `perspective(1000px) rotateX(${-(e.clientY - rect.top - 140)/8}deg) rotateY(${(e.clientX - rect.left - 140)/8}deg) scale(0.92)`;
                updateUI();
                if (tapCounter >= 4000) {
                    tapCounter = 0; tg.showAlert("Milestone! Ad Bonus: +1,000.");
                    window.Adsgram.init({ blockId: "22672" }).show().then(() => { bal += 1000; updateUI(); }).catch(() => updateUI());
                }
            }
        });
        coin.addEventListener('pointerup', () => coin.style.transform = "perspective(1000px) scale(1)");

        function runAd() { window.Adsgram.init({ blockId: "22672" }).show().then(() => { bal += 1000; updateUI(); }).catch((err) => tg.showAlert("Ad unavailable: " + err.description)); }
        function buyBoost(t) { let c = (t === 'speed' ? lvlSpeed + 1 : lvlTank + 1) * 250; if (bal >= c) { if(t==='speed') lvlSpeed++; else lvlTank++; updateUI(); } else tg.showAlert("Need more coins!"); }
        function strictSubscribe() { if (document.getElementById('secret-code').value.trim() === REQUIRED_CODE) { userNick = document.getElementById('username-input').value.trim() || "ELITE"; isPremium = true; updateUI(); } else tg.showAlert("Wrong Code!"); }
        function factoryReset() { tg.showConfirm("Reset everything?", (ok) => { if(ok) { localStorage.clear(); window.location.reload(); } }); }
        function showTab(id, el) { document.querySelectorAll('.container').forEach(c => c.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById(id).classList.add('active'); el.classList.add('active'); }
        function sendWA() { window.open(`https://wa.me/2348124647818?text=Premium: ${userId}`); }
        
        setInterval(() => { if (eng < (500 + lvlTank * 500)) { eng += lvlSpeed; updateUI(); } }, 1000);
        setInterval(() => { if (isPremium) { bal += 10; updateUI(); } }, 1000);
        updateUI();

        // FEED
        const namesPool = ["Abigail", "Benson", "Chidi", "Dada", "Efe", "Femi", "Gani", "Hassan", "Ife", "Joy", "Kola", "Ladi", "Musa", "Ngozi", "Obi", "Patience", "Quasim", "Rabi", "Sola", "Tunde", "Uche", "Victor", "Wale", "Yemi", "Zainab", "Ali", "Bassey", "Cynthia", "Danjuma", "Evelyn", "Fidelis", "Grace", "Hope", "Idris", "John", "Kemi", "Lucky", "Moyo", "Nkechi", "Olu", "Paul", "Queen", "Rose", "Segun", "Taiwo", "Umar", "Vera", "Wisdom", "Yusuf", "Zion"];
        function showFeed() {
            const feed = document.getElementById('reward-feed');
            let pool = [...namesPool]; if (isPremium) pool.push(userNick);
            const name = pool[Math.floor(Math.random() * pool.length)];
            const actions = ["just Subscribed!", "redeemed a Diamond!", "reached 4k taps!", "activated Turbo!", "watching Ads!"];
            feed.innerText = `üéâ Member ${name.toUpperCase()} ${actions[Math.floor(Math.random()*actions.length)]}`;
            feed.classList.add('show');
            setTimeout(() => feed.classList.remove('show'), 4000);
            setTimeout(showFeed, 12000);
        }
        showFeed();
    </script>
</body>
</html>
