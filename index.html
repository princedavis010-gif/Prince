<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Tap: Elite</title>
    <script src="https://adsgram.ai/sdk/v1/adman.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f3ba2f; --green: #00ff88; --dia: #00d2ff; --red: #ff4444; }
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; color: white; background: #0b0e11; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: none; }
        .bg-animate { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% 50%, #1c1f24 0%, #0b0e11 100%); }
        .blob { position: absolute; width: 350px; height: 350px; background: linear-gradient(135deg, rgba(243, 186, 47, 0.1), rgba(0, 210, 255, 0.1)); filter: blur(90px); border-radius: 50%; animation: move 20s infinite alternate; }
        @keyframes move { from { transform: translate(-20%, -20%); } to { transform: translate(20%, 20%); } }
        #reward-feed { position: absolute; top: -60px; left: 50%; transform: translateX(-50%); width: 85%; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); padding: 10px; border-radius: 12px; font-size: 11px; font-weight: bold; color: var(--dia); transition: top 0.5s; z-index: 4000; text-align: center; }
        #reward-feed.show { top: 15px; }
        .container { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 120px; }
        .container.active { display: flex; }
        .btn-gold { background: linear-gradient(to bottom, #f3ba2f, #bf9524); color: #403108; padding: 15px; border-radius: 14px; font-weight: 800; border: none; width: 95%; text-transform: uppercase; cursor: pointer; margin-top: 10px; box-shadow: 0 5px 0 #8e6d1a; transition: transform 0.05s; }
        .btn-gold:active { transform: translateY(4px); box-shadow: 0 1px 0 #8e6d1a; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); width: 90%; padding: 15px; border-radius: 18px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 12px; }
        .coin-btn { width: 280px; height: 280px; background: radial-gradient(circle at 30% 30%, #ffe08a 0%, #f3ba2f 40%, #bf9524 100%); border-radius: 50%; border: 4px solid #5c4711; outline: 8px solid var(--gold); outline-offset: -12px; box-shadow: 0 20px 40px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; font-size: 130px; color: #5c4711; font-weight: 900; transition: transform 0.1s; }
        .nav { height: 75px; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; position: fixed; bottom: 0; width: 100%; border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 3000;}
        .nav-item { color: #888; font-size: 11px; text-align: center; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--gold); }
        #lock-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <div class="bg-animate"><div class="blob"></div></div>
    <div id="reward-feed"></div>

    <div id="lock-screen">
        <h1 style="color:var(--gold);">REDEEM PENDING</h1>
        <p>App locked until Diamond is cleared.</p>
        <input type="text" id="admin-clear-input" class="btn-gold" style="background:rgba(255,255,255,0.1); color:#fff; width:80%;" placeholder="Clearance Code">
        <button class="btn-gold" style="background:var(--green);" onclick="clearDiamond()">Unlock</button>
    </div>

    <div id="home" class="container active">
        <div id="user-display" style="color:var(--green); font-size:14px; font-weight:bold;"></div>
        <div id="balance" style="font-size: 50px; font-weight: 900; color: var(--gold);">0</div>
        <div style="color: var(--dia); font-weight: bold; font-size: 20px;">üíé <span id="diamonds">0</span></div>
        <div style="color: #ccc;">‚ö° <span id="energy">1000</span> / <span id="max-energy">1000</span></div>
        <div class="coin-wrap" style="perspective:1000px; margin: 20px 0;"><div class="coin-btn" id="coin">P</div></div>
        
        <button class="btn-gold" style="background: var(--dia); color: #004a5c;" onclick="runAdsgram()">üì∫ Watch Ad (+1,000 Coins)</button>
    </div>

    <div id="settings" class="container">
        <h2 style="color: var(--gold);">Admin & Safety</h2>
        <div class="glass-card" style="text-align:center;">
            <p id="p-username" style="font-size: 20px; font-weight:bold; color:var(--green);">GUEST</p>
            <p style="font-size:12px;">Suffix: <span id="p-suffix"></span></p>
        </div>
        <button class="btn-gold" style="background:var(--dia); color:#000;" onclick="requestRedeem()">Request ‚Ç¶100 Airtime</button>
        
        <button class="btn-gold" style="background:var(--red); color:#fff; margin-top:40px;" onclick="safeReset()">‚ö†Ô∏è Factory Reset</button>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="showTab('home', this)">ü™ô<br>Tap</div>
        <div class="nav-item" onclick="showTab('settings', this)">‚öôÔ∏è<br>Admin</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "00";
        const suffix = parseInt(String(userId).slice(-2));

        // STORAGE & DATA
        let bal = parseInt(localStorage.getItem('bal_'+userId)) || 0;
        let diamonds = parseInt(localStorage.getItem('dia_'+userId)) || 0;
        let eng = 1000;

        // --- NETWORK & ADS INTEGRATION ---
        const AdController = window.Adsgram.init({ blockId: "22672" });

        function runAdsgram() {
            // Show ad with automatic fallback for slow networks
            AdController.show().then(() => {
                bal += 1000;
                updateUI();
                tg.showAlert("‚úÖ Ad Reward: +1,000 Coins!");
            }).catch(() => {
                tg.showAlert("Ads are loading slow on your network. Try switching to 4G or wait a moment.");
            });
        }

        // --- SAFETY RESET WITH WARNING ---
        function safeReset() {
            tg.showConfirm(
                "‚ö†Ô∏è WARNING: FACTORY RESET!\n\nThis will permanently DELETE all your coins, diamonds, and progress. This action cannot be undone.\n\nAre you sure you want to reset everything?", 
                (confirmed) => {
                    if (confirmed) {
                        localStorage.clear();
                        window.location.reload();
                    } else {
                        tg.showAlert("Reset Cancelled. Your progress is safe.");
                    }
                }
            );
        }

        function updateUI() {
            if (bal >= 20000) { bal = 0; diamonds++; updateUI(); tg.showAlert("üíé 1 Diamond Earned!"); }
            document.getElementById('balance').innerText = bal.toLocaleString();
            document.getElementById('diamonds').innerText = diamonds;
            document.getElementById('energy').innerText = eng;
            document.getElementById('p-username').innerText = "PRINCE_" + suffix;
            document.getElementById('p-suffix').innerText = suffix;
            
            localStorage.setItem('bal_'+userId, bal);
            localStorage.setItem('dia_'+userId, diamonds);
            if (localStorage.getItem('locked_'+userId) === 'true') document.getElementById('lock-screen').style.display = 'flex';
        }

        // TAPPING LOGIC
        const coin = document.getElementById('coin');
        coin.addEventListener('pointerdown', (e) => {
            if (eng > 0) {
                bal++; eng--; updateUI();
                const rect = coin.getBoundingClientRect();
                coin.style.transform = `perspective(1000px) scale(0.92)`;
            }
        });
        coin.addEventListener('pointerup', () => coin.style.transform = "perspective(1000px) scale(1)");

        function requestRedeem() {
            if (diamonds >= 1) {
                localStorage.setItem('locked_'+userId, 'true');
                window.open(`https://wa.me/2348124647818?text=Redeem Request. Suffix: ${suffix}`);
                updateUI();
            } else tg.showAlert("Need 1 Diamond!");
        }

        function clearDiamond() {
            if (document.getElementById('admin-clear-input').value.trim() === "Clear" + (suffix * 2)) {
                diamonds--; localStorage.removeItem('locked_'+userId);
                document.getElementById('lock-screen').style.display = 'none'; updateUI();
            }
        }

        function showTab(id, el) { 
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active'); el.classList.add('active');
        }

        setInterval(() => { if (eng < 1000) { eng++; updateUI(); } }, 1000);
        updateUI();
    </script>
</body>
</html>
