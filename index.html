<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Tap Master Ultimate</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<!-- Adsgram -->
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<style>
:root { --gold:#f3ba2f; --green:#00ff88; --dia:#00d2ff; --purple:#a020f0; --bg:#010205; }
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:white;overflow:hidden;display:flex;flex-direction:column;align-items:center;}
.container{display:flex;flex-direction:column;align-items:center;width:100%;padding:20px;}
.coin-btn{width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,#ffe08a,#f3ba2f,#8e6d1a);display:flex;align-items:center;justify-content:center;font-size:100px;font-weight:900;cursor:pointer;user-select:none;margin:15px 0;transition:0.1s;transform-style:preserve-3d;}
.btn-gold{padding:12px 20px;border:none;border-radius:12px;background:var(--gold);color:#221a04;font-weight:bold;cursor:pointer;margin:5px;}
#balance{font-size:48px;font-weight:900;margin-bottom:10px;cursor:pointer;}
#diamonds{font-size:20px;font-weight:bold;color:var(--dia);margin-bottom:20px;}
.nebula-bg{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-2;background:#010205;}
.nebula-glow{position:absolute;width:200%;height:200%;top:-50%;left:-50%;background:radial-gradient(circle, rgba(160,32,240,0.4) 0%, rgba(0,210,255,0.1) 40%, transparent 70%);opacity:0;transition:1.5s;z-index:-1;pointer-events:none;}
body.boost-active .nebula-glow{opacity:1;animation:supernova 3s infinite linear;}
@keyframes supernova{0%{transform:scale(1) rotate(0deg);}100%{transform:scale(1.3) rotate(360deg);}}
#admin-panel{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:9999;overflow:auto;padding:20px;}
.admin-table{width:100%;border-collapse:collapse;margin-top:20px;}
.admin-table th, .admin-table td{border:1px solid #444;padding:8px;text-align:center;}
.admin-table th{background:var(--gold);color:#000;}
.admin-table input{width:60px;text-align:center;border-radius:4px;border:none;}
#leaderboard{margin-top:20px;width:100%;border-collapse:collapse;}
#leaderboard th, #leaderboard td{border:1px solid #444;padding:8px;text-align:center;}
#leaderboard th{background:var(--gold);color:#000;}
</style>
</head>
<body>

<div class="nebula-bg"><div class="nebula-glow"></div></div>

<div class="container" id="game-container">
    <div id="balance">0</div>
    <div>ðŸ’Ž <span id="diamonds">0</span></div>
    <div class="coin-btn" id="coin">P</div>
    <div id="boost-timer" style="color:var(--purple); font-weight:bold; height:20px;"></div>
    <div style="color:#777; font-size:12px;">âš¡ <span id="energy">1000</span> / 1000</div>
    <button class="btn-gold" id="boost-btn">Activate Boost (5X)</button>
    <button class="btn-gold" id="ad-btn">ðŸ“º Watch Ad (+2000)</button>
    <input type="text" id="premium-code" placeholder="Enter Premium Code" style="margin:10px;padding:8px;border-radius:8px;">
    <button class="btn-gold" id="premium-btn">Activate Premium</button>
    <button class="btn-gold" id="redeem-btn">Redeem 1 Diamond</button>
    <div class="glass-card" style="background: rgba(255,255,255,0.06); border-radius: 18px; padding:10px; margin-top:15px; border:1px solid rgba(255,255,255,0.1); text-align:center;">
        <p>Follow @ogprincedavis5081 on TikTok and like all videos</p>
        <button class="btn-gold" id="tiktok-btn" style="background:#ff0050; color:white;">GO TO TIKTOK (+5000)</button>
    </div>
    <h3 style="margin-top:20px;">Leaderboard</h3>
    <table id="leaderboard">
        <thead><tr><th>Rank</th><th>User</th><th>Coins</th></tr></thead>
        <tbody id="leaderboard-body"></tbody>
    </table>
</div>

<div id="admin-panel">
    <h2 style="color:var(--gold); text-align:center;">ADMIN DASHBOARD</h2>
    <button class="btn-gold" onclick="closeAdmin()">Close Admin Panel</button>
    <table class="admin-table">
        <thead>
            <tr>
                <th>User UID</th>
                <th>Coins</th>
                <th>Diamonds</th>
                <th>Boosts</th>
                <th>Energy</th>
                <th>Premium</th>
                <th>Referrals</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="admin-users"></tbody>
    </table>
</div>

<script>
// Firebase config
const firebaseConfig = {apiKey:"YOUR_API_KEY",authDomain:"YOUR_PROJECT.firebaseapp.com",projectId:"YOUR_PROJECT",storageBucket:"YOUR_PROJECT.appspot.com",messagingSenderId:"SENDER_ID",appId:"APP_ID"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();

// Adsgram
const AdController = window.Adsgram.init({ blockId: "22672" });

let uid, userData={coins:0,diamonds:0,boosts:2,energy:1000,isPremium:false,isBoosted:false,salt:1,referrals:0,referrer:null};

// Referral from URL
const urlParams = new URLSearchParams(window.location.search);
const ref = urlParams.get('ref');

auth.signInAnonymously().then(async cred=>{
    uid=cred.user.uid;
    const userRef=db.collection('users').doc(uid);
    const doc=await userRef.get();
    if(doc.exists){userData=doc.data();}
    else{
        if(ref){userData.referrer=ref;}
        await userRef.set(userData);
        if(ref){
            const refDoc=db.collection('users').doc(ref);
            refDoc.get().then(d=>{
                if(d.exists){const r=d.data(); refDoc.update({coins:(r.coins||0)+500,referrals:(r.referrals||0)+1});}
            });
        }
    }
    updateUI();
    loadLeaderboard();
});

// Update UI
function updateUI(){
    document.getElementById('balance').innerText=userData.coins;
    document.getElementById('diamonds').innerText=userData.diamonds;
    document.getElementById('energy').innerText=userData.energy;
    document.getElementById('boost-timer').innerText=userData.isBoosted?'WARP ACTIVE':'';
    saveData();
    loadLeaderboard();
}

// Save user
function saveData(){db.collection('users').doc(uid).set(userData);}

// Coin Tap
document.getElementById('coin').addEventListener('click',()=>{
    if(userData.energy<=0)return;
    let val=(userData.isPremium?20:1)*(userData.isBoosted?5:1);
    userData.coins+=val;
    userData.energy--;
    confetti({particleCount:20,spread:90,origin:{y:0.6}});
    updateUI();
});

// Boost
document.getElementById('boost-btn').addEventListener('click',()=>{
    if(userData.boosts<=0||userData.isBoosted)return;
    userData.boosts--; userData.isBoosted=true;
    saveData();
    let sec=20;
    const t=setInterval(()=>{sec--;document.getElementById('boost-timer').innerText=`WARP ACTIVE: ${sec}s`;if(sec<=0){clearInterval(t);userData.isBoosted=false;document.getElementById('boost-timer').innerText='';saveData();}},1000);
});

// Ads
document.getElementById('ad-btn').addEventListener('click',()=>{AdController.show().then(()=>{userData.coins+=2000;updateUI();});});

// Premium
document.getElementById('premium-btn').addEventListener('click',async ()=>{
    const code=document.getElementById('premium-code').value.trim();
    const res=await fetch(`https://YOUR_CLOUD_FUNCTIONS_URL/verifyPremium?uid=${uid}&code=${code}`);
    const data=await res.json();
    if(data.success){userData.isPremium=true;saveData();alert("Premium Activated!");}else alert("Invalid Code");
});

// Redeem
document.getElementById('redeem-btn').addEventListener('click',async ()=>{
    if(userData.diamonds<1)return alert("Not enough diamonds!");
    const res=await fetch(`https://YOUR_CLOUD_FUNCTIONS_URL/redeemDiamond?uid=${uid}`);
    const data=await res.json();
    if(data.success){userData.diamonds--;saveData();alert("Redeemed â‚¦100");}else alert("Error redeeming");
});

// TikTok Task
document.getElementById('tiktok-btn').addEventListener('click',()=>{
    window.open("https://www.tiktok.com/@ogprincedavis5081","_blank");
    setTimeout(()=>{userData.coins+=5000;saveData();alert("Task Verified! +5000 Coins");},5000);
});

// Leaderboard
async function loadLeaderboard(){
    const lb=document.getElementById('leaderboard-body'); lb.innerHTML='';
    const snap=await db.collection('users').orderBy('coins','desc').limit(10).get();
    let rank=1; snap.forEach(doc=>{const u=doc.data();const tr=document.createElement('tr');tr.innerHTML=`<td>${rank}</td><td>${doc.id}</td><td>${u.coins}</td>`;lb.appendChild(tr);rank++;});
}

// Admin Panel
let adminTaps=0;
document.getElementById('balance').addEventListener('click',()=>{
    adminTaps++;
    if(adminTaps>=5){const pwd=prompt("Enter Admin Password:");if(pwd==="Davis2026"){openAdmin();}adminTaps=0;}
});

async function openAdmin(){document.getElementById('admin-panel').style.display='block';loadAllUsers();}
function closeAdmin(){document.getElementById('admin-panel').style.display='none';}
async function loadAllUsers(){const tbody=document.getElementById('admin-users');tbody.innerHTML='';const snapshot=await db.collection('users').get();snapshot.forEach(doc=>{const u=doc.data();const tr=document.createElement('tr');tr.innerHTML=`<td>${doc.id}</td><td><input type="number" value="${u.coins}" onchange="updateUser('${doc.id}','coins',this.value)"></td><td><input type="number" value="${u.diamonds}" onchange="updateUser('${doc.id}','diamonds',this.value)"></td><td><input type="number" value="${u.boosts}" onchange="updateUser('${doc.id}','boosts',this.value)"></td><td><input type="number" value="${u.energy}" onchange="updateUser('${doc.id}','energy',this.value)"></td><td><input type="checkbox" ${u.isPremium?'checked':''} onchange="updateUser('${doc.id}','isPremium',this.checked)"></td><td>${u.referrals||0}</td><td><button onclick="deleteUser('${doc.id}')">Delete</button></td>`;tbody.appendChild(tr);});}

function updateUser(userId,field,value){const ref=db.collection('users').doc(userId);let val=value;if(field==='isPremium'){val=Boolean(value);}else{val=Number(value);}ref.update({[field]:val});}
function deleteUser(userId){db.collection('users').doc(userId).delete().then(()=>loadAllUsers());}

// Energy regen
setInterval(()=>{if(userData.energy<1000){userData.energy++;updateUI();}},1500);
</script>
</body>
</html>
